<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Delfast bluetooth test</title>
</head>

<body>
    <div class="header">
        <h1>Delfast bike</h1>
        <button id="inspect">Inspect BLE</button>
        <button id="connect">CONNECT</button>
        <div id="conn_state">Not connected</div>
    </div>
    <div class="control" style="display: none">
        <h1>Control</h1>
        <!-- <button id="test">Test</button> -->
        <div class="state">
            <h4>Inputs</h4>
            <div class="inputs">
                <div id="in_horn">Horn</div>
                <div id="in_break">Break</div>
                <div id="in_turn_l">Turn L</div>
                <div id="in_turn_r">Turn R</div>
                <div id="in_h_beam">H Beam</div>
                <div id="in_l_beam">L Beam</div>
                <div id="in_h_speed">H Speed</div>
                <div id="in_l_speed">L Speed</div>
                <div id="in_throttle">Throttle</div>
                <div id="in_pas">PAS</div>

                <!-- // Not a inputs, but place here while a better time -->
                <div id="in_panic">Panic</div>
                <div id="in_drive">Drive</div>
                <div id="in_guard">Guard</div>

            </div>
        </div>
    </div>
    <div class="debug">
        <textarea name="debug" rows="8" cols="80"></textarea>
    </div>

    <div id="logs">Log output:</div>
    <script src="bt.js"></script>
    <script src="inspectBle.js"></script>
    <script src="app.js"></script>
</body>

</html>
<!--script>
    // Function to display logs on the website instead of console
    function Log(msg){
    document.querySelector('#logs').innerHTML =
                    document.querySelector('#logs').innerHTML + "<br>" + msg
    }

    document.querySelector('button').addEventListener('click', async event => {
        navigator.bluetooth.requestDevice({
            acceptAllDevices: true,
            optionalServices: ['0000a002-0000-1000-8000-00805f9b34fb']
            // filters: [{ services: ['0000a002-0000-1000-8000-00805f9b34fb'] }]
            // filters: [{ services: ['0000a002-0000-1000-8000-00805f9b34fb'] }]
            // filters: [{ services: [0xa002] }]
        })
        .then(device => {
            console.log("Connecting to device", device);
            Log("connecting to " + device.name);
            // Attempts to connect to remote GATT Server.
            return device.gatt.connect();
        })
        .then(server => {
            console.log("Connected server", server);
            // Getting Service…
            // ESP? 4c444d00-0000-1000-8000-00805f9b34fb
            // return server.getPrimaryService("0000ffff-0000-1000-8000-00805f9b34fb");
            return server.getPrimaryService("0000a002-0000-1000-8000-00805f9b34fb");    // Button service?
            // return server.getPrimaryService("000000ff-0000-1000-8000-00805f9b34fb");
            // return server.getPrimaryService("4fafc201-1fb5-459e-8fcc-c5c9c331914b");
        })
        .then(service => {
            // Getting Characteristic…
                    // return service.getCharacteristic("beb5483e-36e1-4688-b7f5-ea07361b26a8");
                    // return service.getCharacteristic("0000ff01-0000-1000-8000-00805f9b34fb");   // write
                    // return service.getCharacteristic("0000ff02-0000-1000-8000-00805f9b34fb");   // read
                    // return service.getCharacteristic("0000a003-0000-1000-8000-00805f9b34fb");   // button characteristic
            return service.getCharacteristic("0000c300-0000-1000-8000-00805f9b34fb");   // button characteristic
            // return service.getCharacteristics();   // all characteristic
        })
        // .then(characteristics => {
        //     console.log("characteristics", characteristics);
        // })

        .then(characteristic => {
            // Reading value
            console.log("characteristic", characteristic);
            return characteristic.readValue();
        })
        .then(value => {
            Log(`Value is ${value.getUint8(0)}`);
        })

        .catch(error => { console.error(error); });
    });
</script-->
